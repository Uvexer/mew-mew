# Sky Pilot - iOS Aviation Game

## Описание проекта

**Sky Pilot** — нативное iOS-приложение, реализованное на Swift с использованием SwiftUI. Это интерактивная игра на авиационную тематику, где пользователь управляет самолетом, избегая препятствий и набирая очки. Приложение включает систему статистики, историю полетов и полную интеграцию с Core Data для хранения данных.

## Технические характеристики

- **Платформа**: iOS 16.0+
- **Язык**: Swift 5.9+
- **UI Framework**: SwiftUI
- **Архитектура**: MVVM (Model-View-ViewModel)
- **Хранилище данных**: Core Data
- **Асинхронность**: async/await
- **Логирование**: OSLog (os.Logger)

## Функциональность

### Основные возможности

1. **Игровой процесс**
   - Управление самолетом через тач-жесты (drag gesture)
   - Динамическая генерация препятствий (облака и птицы)
   - Система подсчета очков в реальном времени
   - Детекция коллизий с автоматическим завершением игры
   - Адаптивный интерфейс для разных размеров экранов

2. **Статистика и история**
   - Сохранение результатов каждого полета
   - Отображение рекордного счета
   - Подсчет общего количества полетов
   - Вычисление среднего счета
   - История последних 20 полетов с датой и временем
   - Возможность удаления всей истории

3. **Персистентность данных**
   - Автоматическое сохранение результатов через Core Data
   - Хранение настроек игры
   - Восстановление данных при перезапуске приложения

## Структура проекта

```
planeAppTwo/
├── Models/
│   ├── Flight.swift                 # Модель полета
│   ├── GameSettings.swift          # Модель настроек
│   └── Obstacle.swift              # Модель препятствия
├── ViewModels/
│   ├── GameViewModel.swift         # ViewModel игры
│   └── StatsViewModel.swift        # ViewModel статистики
├── Views/
│   ├── MainMenuView.swift          # Главное меню
│   ├── GameView.swift              # Игровой экран
│   ├── StatsView.swift             # Экран статистики
│   └── Components/
│       ├── PlaneView.swift         # Компонент самолета
│       └── ObstacleView.swift      # Компонент препятствия
├── Services/
│   ├── PersistenceController.swift # Управление Core Data
│   └── DataService.swift           # Сервис работы с данными
├── PlaneAppModel.xcdatamodeld/     # Core Data модель
├── Assets.xcassets/                # Графические ресурсы
└── planeAppTwoApp.swift            # Точка входа приложения
```

## Архитектура

### MVVM Pattern

Приложение строго следует паттерну MVVM:

- **Models**: Чистые структуры данных без бизнес-логики
- **Views**: SwiftUI компоненты, отображающие состояние
- **ViewModels**: Управление состоянием и бизнес-логика
- **Services**: Инкапсуляция работы с данными и внешними системами

### Core Data

Схема данных состоит из двух сущностей:

1. **FlightEntity**
   - `id: UUID` — уникальный идентификатор
   - `date: Date` — дата и время полета
   - `score: Int32` — набранные очки
   - `duration: Int32` — продолжительность в секундах
   - `obstaclesAvoided: Int32` — количество избегнутых препятствий

2. **GameSettingsEntity**
   - `difficulty: Int16` — уровень сложности
   - `soundEnabled: Bool` — включение звука
   - `highScore: Int32` — рекордный счет
   - `totalFlights: Int32` — общее количество полетов

### Управление данными

- **PersistenceController**: Инициализация и настройка NSPersistentContainer
- **DataService**: Высокоуровневый API для работы с Core Data
  - Сохранение результатов полетов
  - Загрузка истории
  - Управление настройками
  - Автоматическое обновление статистики

## Инструкция по запуску

### Требования

- macOS 13.0+ (Ventura или новее)
- Xcode 15.0+
- iOS Simulator или физическое устройство с iOS 16.0+

### Шаги для запуска

1. **Открытие проекта**
   ```bash
   cd "/Users/bogdanchupakhin/Documents/SMT proj/planeAppTwo"
   open planeAppTwo.xcodeproj
   ```

2. **Выбор целевого устройства**
   - В Xcode выберите целевое устройство из выпадающего списка
   - Рекомендуется: iPhone 15 Pro или любой симулятор с iOS 16+

3. **Сборка и запуск**
   - Нажмите Cmd + R или кнопку "Run"
   - Дождитесь завершения сборки
   - Приложение запустится на выбранном устройстве

### Проверка работоспособности

После запуска приложения проверьте:

1. Отображение главного меню
2. Запуск игры через кнопку "Start Flight"
3. Управление самолетом через касание/перетаскивание
4. Появление препятствий
5. Завершение игры при столкновении
6. Сохранение результата в статистике
7. Отображение истории полетов

## Основная логика приложения

### Игровой цикл

Игра работает на основе двух асинхронных таймеров:

1. **Основной игровой цикл** (60 FPS)
   - Обновление позиций препятствий
   - Проверка коллизий
   - Подсчет очков
   - Запускается в Task при старте игры

2. **Генератор препятствий**
   - Создание новых препятствий каждые 1.5 секунды
   - Случайная высота и тип (облако или птица)
   - Автоматическая очистка за пределами экрана

### Управление

- Пользователь управляет самолетом через DragGesture
- Позиция самолета ограничена границами экрана
- Координаты корректируются с учетом размера самолета

### Детекция коллизий

- Каждый кадр проверяется пересечение CGRect самолета и препятствий
- При обнаружении коллизии игра завершается
- Результаты автоматически сохраняются в Core Data

### Работа с Core Data

1. **Инициализация**
   - PersistenceController создается при запуске приложения
   - NSPersistentContainer загружает модель данных
   - ViewContext внедряется в SwiftUI Environment

2. **Сохранение данных**
   - При завершении игры вызывается `DataService.saveFlight()`
   - Создается новая FlightEntity с результатами
   - Автоматически обновляются статистические данные
   - Context сохраняется на диск

3. **Загрузка данных**
   - Fetch запросы выполняются через DataService
   - Данные преобразуются из Entity в модели
   - ViewModels публикуют обновления через @Published

### Многопоточность

- ViewModels помечены @MainActor для работы в главном потоке
- Core Data операции выполняются на viewContext
- Асинхронные таймеры используют Task с проверкой cancellation

## Адаптивность

### Поддержка экранов

Приложение корректно работает на:
- iPhone SE (малый экран)
- iPhone 15 Pro и аналогичные
- iPhone 15 Pro Max (большой экран)
- iPad всех размеров
- Split View на iPad

### Ориентация

- Поддерживается портретная и альбомная ориентация
- Используется GeometryReader для адаптивных размеров
- Все позиции рассчитываются относительно размера экрана

### Темы

- Полная поддержка светлой темы
- Полная поддержка темной темы
- Автоматическая адаптация к системным настройкам

## Производительность

### Оптимизации

- Использование LazyVGrid для эффективного отображения списков
- Минимизация перерисовок через правильное использование @Published
- Отсутствие бесконечных циклов в body
- Корректная отмена Task при завершении игры

### Управление памятью

- Автоматическая очистка препятствий за пределами экрана
- Использование weak self в async контекстах
- Отсутствие retain cycles

## Логирование

Используется os.Logger с категориями:

- **persistence**: операции Core Data
- **dataservice**: работа с данными
- **game**: игровые события
- **stats**: статистика

Логируются:
- Успешная загрузка Core Data
- Сохранение полетов
- Начало/завершение игры
- Обновление рекордов
- Удаление данных

## Обработка ошибок

- Все потенциальные ошибки обрабатываются через do-catch
- При ошибках Core Data возвращаются безопасные значения по умолчанию
- Отсутствует использование fatalError
- Graceful degradation при недоступности данных

## Подготовка к публикации

### Перед загрузкой в App Store Connect

1. Обновите Bundle Identifier в проекте
2. Настройте Signing & Capabilities
3. Установите корректную версию и build number
4. Добавьте Privacy Manifest при необходимости
5. Создайте архив через Product > Archive
6. Проверьте отсутствие warnings в Xcode

### Рекомендации

- Протестируйте на физических устройствах разных размеров
- Проверьте работу в темной теме
- Убедитесь в корректном сохранении данных после kill приложения
- Проверьте производительность на старых устройствах (iPhone SE 2)

## Возможные улучшения

В будущих версиях можно добавить:

- Звуковые эффекты и музыку
- Несколько уровней сложности с разной скоростью
- Систему достижений
- Таблицу лидеров через Game Center
- Дополнительные типы самолетов
- Power-ups и бонусы
- Анимации и частицы
- Режим бесконечного полета

## Техническая поддержка

При возникновении проблем:

1. Проверьте логи в Console.app
2. Убедитесь в соответствии требованиям системы
3. Выполните Clean Build Folder (Cmd + Shift + K)
4. Удалите Derived Data

## Лицензия

Проект создан как демонстрация возможностей SwiftUI и Core Data. Все права защищены.

---

**Версия документации**: 1.0
**Дата создания**: Январь 2026
**Разработчик**: Senior iOS Developer

