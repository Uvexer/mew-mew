# Animal Encyclopedia - Энциклопедия Животных

## Описание проекта

**Animal Encyclopedia** — это образовательное iOS-приложение, объединяющее энциклопедию животных и интерактивную викторину. Приложение позволяет пользователям изучать информацию о различных видах животных, добавлять их в избранное и проверять свои знания с помощью увлекательной игры.

### Основные возможности

1. **Энциклопедия животных**
   - Просмотр детальной информации о животных
   - Фильтрация по категориям (млекопитающие, птицы, рептилии, рыбы)
   - Поиск по названию, научному названию и описанию
   - Добавление животных в избранное
   - Адаптивная сетка карточек для разных размеров экранов

2. **Викторина**
   - 10 вопросов о животных в каждой игре
   - Разные типы вопросов (название, среда обитания, научное название)
   - Визуальная обратная связь по ответам
   - Отслеживание прогресса во время игры
   - Результаты с процентным соотношением правильных ответов

3. **Статистика**
   - Общая статистика: количество игр, правильных ответов, средний результат
   - История последних 10 игр с детальными результатами
   - Визуальные карточки с ключевыми показателями

## Технические характеристики

### Требования
- **Платформа**: iOS 16.0+
- **Язык**: Swift 5.9+
- **Фреймворк**: SwiftUI
- **Хранилище**: Core Data
- **Архитектура**: MVVM

### Технологический стек

#### Основные технологии
- **SwiftUI** — декларативный UI-фреймворк
- **Core Data** — локальное хранилище данных
- **Combine** — реактивное программирование через `@Published` свойства
- **async/await** — асинхронные операции
- **OSLog** — системное логирование

#### Архитектурные паттерны
- **MVVM (Model-View-ViewModel)** — разделение логики и представления
- **Dependency Injection** — передача зависимостей через инициализаторы
- **Repository Pattern** — инкапсуляция работы с данными в сервисах

## Структура проекта

```
animalAppThree/
├── animalAppThreeApp.swift          # Точка входа приложения
│
├── CoreData/
│   └── PersistenceController.swift  # Управление Core Data stack
│
├── Models/
│   ├── Animal.swift                 # Модель животного
│   ├── GameScore.swift              # Модель результатов игры
│   └── QuizQuestion.swift           # Модель вопроса викторины
│
├── Services/
│   ├── AnimalDataService.swift      # Сервис работы с животными
│   └── GameService.swift            # Сервис игровой логики
│
├── ViewModels/
│   ├── EncyclopediaViewModel.swift  # ViewModel энциклопедии
│   └── GameViewModel.swift          # ViewModel игры
│
├── Views/
│   ├── MainTabView.swift            # Главный TabView
│   ├── EncyclopediaView.swift       # Экран энциклопедии
│   ├── GameView.swift               # Экран викторины
│   ├── StatisticsView.swift         # Экран статистики
│   └── Components/
│       └── AnimalComponents.swift   # Переиспользуемые компоненты
│
├── Utilities/
│   └── PlaceholderImageGenerator.swift
│
└── Assets.xcassets/                 # Графические ресурсы
```

## Core Data Schema

### Сущности

#### AnimalEntity
- `id: UUID` — уникальный идентификатор
- `name: String` — название животного
- `scientificName: String` — научное название
- `animalDescription: String` — описание
- `habitat: String` — среда обитания
- `lifespan: String` — продолжительность жизни
- `fact: String` — интересный факт
- `category: String` — категория (enum в виде строки)
- `imageName: String` — имя изображения
- `isFavorite: Bool` — флаг избранного

#### GameScoreEntity
- `id: UUID` — уникальный идентификатор
- `correctAnswers: Int16` — количество правильных ответов
- `totalQuestions: Int16` — общее количество вопросов
- `date: Date` — дата игры

#### UserProgressEntity
- `id: UUID` — уникальный идентификатор
- `gamesPlayed: Int32` — количество сыгранных игр
- `totalCorrectAnswers: Int32` — общее количество правильных ответов
- `totalQuestions: Int32` — общее количество вопросов

### Инициализация данных

При первом запуске приложения автоматически создается база из 12 животных:
- 4 млекопитающих (слон, тигр, кит, красная панда)
- 3 птицы (пингвин, беркут, колибри)
- 3 рептилии (морская черепаха, кобра, хамелеон)
- 2 рыбы (акула, рыба-клоун)

## MVVM Архитектура

### Принципы разделения ответственности

#### Model (Модель)
- Чистые структуры данных (`Animal`, `GameScore`, `UserProgress`)
- Не содержат бизнес-логики
- Инициализация из Core Data сущностей
- Immutable свойства (кроме `isFavorite` для оптимизации)

#### View (Представление)
- Отображает состояние из ViewModel
- Не содержит бизнес-логики
- Только UI-код и простые вычисления для вёрстки
- Использует `@ObservedObject` для связи с ViewModel

#### ViewModel
- Управляет состоянием UI через `@Published` свойства
- Взаимодействует с сервисами
- Содержит всю бизнес-логику экрана
- Помечены `@MainActor` для безопасности потоков

#### Services (Сервисы)
- Инкапсулируют работу с Core Data
- Предоставляют высокоуровневый API для ViewModels
- Обрабатывают ошибки и логируют операции

### Поток данных

```
User Action → View → ViewModel → Service → Core Data
                ↑                              ↓
                └──────── @Published ←─────────┘
```

1. Пользователь взаимодействует с View
2. View вызывает метод ViewModel
3. ViewModel запрашивает данные через Service
4. Service обращается к Core Data
5. Данные возвращаются и публикуются через `@Published`
6. View автоматически обновляется

## Адаптивный дизайн

### Принципы адаптивности

1. **GeometryReader** — динамическое вычисление размеров
2. **Адаптивные сетки** — количество колонок зависит от ширины экрана
3. **Минимальные размеры** — `minColumnWidth` для расчета колонок
4. **Пропорциональное масштабирование** — размеры через проценты от экрана

### Поддержка устройств
- iPhone SE (малые экраны)
- iPhone стандартных размеров
- iPhone Plus/Pro Max (большие экраны)
- iPad (Split View, многоколоночные сетки)
- Портретная и альбомная ориентация

### Темы
- Автоматическая поддержка светлой и тёмной темы
- Использование системных цветов (`Color(.systemBackground)`, `.primary`, `.secondary`)
- Семантические цвета для статусов (зелёный для правильных ответов, красный для ошибок)

## Логирование

Приложение использует **OSLog** для системного логирования:

```swift
Logger(subsystem: Bundle.main.bundleIdentifier ?? "AnimalApp", category: "CategoryName")
```

### Категории логирования
- `Persistence` — операции Core Data
- `AnimalData` — работа с животными
- `Game` — игровая логика
- `Encyclopedia` — энциклопедия
- `App` — жизненный цикл приложения

### Уровни логирования
- `.info` — информационные сообщения (загрузка данных, действия пользователя)
- `.error` — ошибки (проблемы с Core Data, отсутствие данных)

## Инструкция по запуску

### Требования
1. macOS 13.0+ (Ventura или новее)
2. Xcode 15.0+
3. iOS Simulator или физическое устройство с iOS 16.0+

### Шаги запуска

1. **Откройте проект**
   ```bash
   open animalAppThree.xcodeproj
   ```

2. **Выберите целевое устройство**
   - В Xcode выберите симулятор или подключенное устройство
   - Рекомендуется: iPhone 15 Pro или iPad Pro

3. **Соберите и запустите**
   - Нажмите `Cmd + R` или кнопку "Run"
   - При первом запуске будет инициализирована база данных

4. **Проверка работоспособности**
   - Откройте вкладку "Энциклопедия" — должны отображаться 12 животных
   - Перейдите в "Игра" и начните викторину
   - После завершения игры проверьте "Статистику"

### Возможные проблемы

#### Проблема: Приложение не собирается
**Решение**: Убедитесь, что используете Xcode 15+ и установлена поддержка iOS 16 SDK

#### Проблема: Пустой экран энциклопедии
**Решение**: Удалите приложение и установите заново — база данных будет пересоздана

#### Проблема: Ошибки Core Data в консоли
**Решение**: Проверьте, что файл `.xcdatamodeld` корректно добавлен в Target Membership

## Расширение функциональности

### Добавление новых животных

1. Откройте `AnimalDataService.swift`
2. Найдите метод `seedInitialData()`
3. Добавьте новую запись в массив `animals`:

```swift
(
    name: "Название",
    scientific: "Научное название",
    description: "Описание",
    habitat: "Среда обитания",
    lifespan: "Продолжительность жизни",
    fact: "Интересный факт",
    category: .mammal, // или .bird, .reptile, .fish
    imageName: "имя_файла"
)
```

4. Добавьте изображение в `Assets.xcassets/Animals/`
5. Удалите и переустановите приложение для пересоздания БД

### Добавление новых типов вопросов

1. Откройте `GameViewModel.swift`
2. Найдите `enum QuestionGenerationType`
3. Добавьте новый кейс
4. Реализуйте генерацию вопроса в методе `generateQuestionForAnimal()`

### Настройка сложности игры

В `GameViewModel.swift` измените константу:
```swift
private let totalQuestions: Int = 10 // Измените на нужное значение
```

## Производительность

### Оптимизации

1. **Ленивая загрузка** — `LazyVGrid` для карточек животных
2. **Минимальные перерисовки** — правильное использование `@Published`
3. **Безопасность потоков** — `@MainActor` для ViewModels
4. **Batch операции** — `NSBatchDeleteRequest` для удаления данных
5. **Кеширование контекста** — переиспользование `viewContext`

### Мониторинг

- Используйте Instruments (Time Profiler, Allocations) для анализа производительности
- Проверяйте Console на наличие предупреждений Core Data
- Тестируйте на старых устройствах (iPhone SE) для проверки плавности

## Тестирование

### Ручное тестирование

1. **Энциклопедия**
   - Проверьте поиск по разным запросам
   - Протестируйте фильтрацию по категориям
   - Добавьте/удалите из избранного
   - Откройте детальную информацию о животном
   - Проверьте адаптивность на iPad в Split View

2. **Игра**
   - Сыграйте несколько раз подряд
   - Проверьте корректность отображения правильных/неправильных ответов
   - Убедитесь, что счёт обновляется правильно
   - Проверьте экран результатов

3. **Статистика**
   - Убедитесь, что общая статистика обновляется
   - Проверьте историю игр (до 10 записей)
   - Проверьте корректность процентов

### Unit тесты (рекомендации)

Для production-версии рекомендуется добавить:
- Тесты для ViewModels (моки сервисов)
- Тесты для Services (in-memory Core Data)
- Тесты для моделей (валидация данных)

## Подготовка к релизу

### Checklist перед публикацией

- [ ] Настроить Bundle Identifier
- [ ] Добавить Privacy Policy (если требуется)
- [ ] Настроить версию и build number
- [ ] Создать скриншоты для App Store (все размеры)
- [ ] Написать описание приложения
- [ ] Подготовить ключевые слова для поиска
- [ ] Настроить иконку приложения (все размеры)
- [ ] Протестировать на реальных устройствах
- [ ] Проверить работу на iOS 16, 17, 18
- [ ] Проверить темную/светлую тему
- [ ] Проверить все ориентации экрана
- [ ] Архивировать и загрузить в App Store Connect

### Настройки проекта

1. **General**
   - Display Name: "Animal Encyclopedia"
   - Bundle Identifier: `com.yourcompany.animalappthree`
   - Version: 1.0.0
   - Build: 1

2. **Signing & Capabilities**
   - Настройте Team
   - Убедитесь в автоматическом подписании

3. **Info.plist** (при необходимости)
   - Добавьте Privacy - Photo Library Usage Description (если будете добавлять функцию сохранения изображений)

## Лицензия и авторство

Проект создан в образовательных целях.
Используемые эмодзи и системные иконки являются частью iOS SDK.

## Контакты и поддержка

Для вопросов по проекту и предложений по улучшению:
- Изучите код в Xcode
- Проверьте логи в Console.app при возникновении проблем
- Используйте Instruments для диагностики производительности

---

**Версия документации**: 1.0  
**Дата**: 2026-01-12  
**Совместимость**: iOS 16.0+

